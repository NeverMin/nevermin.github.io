---
layout: post
title:  "你家的 wifi 安全吗?"
date:   2017-10-25 16:12:00 +0800
categories: blog
description: "wifi 作为我们最普及的[英文单词], 60岁老爷爷老奶奶会说, 威胁小P孩不打开洗手间门拔无线路由器电源管用. 但自从爆出针对 WPA/2 的 KRACK 的漏洞之后, 全世界的 WiFi 一夜之间都不安全了, 别说是你家了."
main-class: 'Security'
color: '#B31917' #7D669E #D6BA32 #7AAB13 #B31917
tags:
- "Security"
introduction: "wifi 作为我们最普及的[英文单词], 60岁老爷爷老奶奶会说, 威胁小P孩不打开洗手间门拔无线路由器电源管用. 但自从爆出针对 WPA/2 的 KRACK 的漏洞之后, 全世界的 WiFi 一夜之间都不安全了, 别说是你家了."
---

如果要回答"你家的 wifi 安全吗?"这个问题, 正确的答案是 **"你家的无线从来没有安全过"**.

自从爆出针对 WPA/2 的 KRACK 的漏洞之后, 我最多被问到的是:
1. 我把无线的 SSID 隐藏有用吗?
1. 我把密码设长一点有用吗?

答案是: 没用!

其实本文到此也就结束了, 如果想了解关于 KRACK 漏洞可以参考下面的资料:
- 安全研究人员演示实现方法 https://www.krackattacks.com/
- 论文 https://papers.mathyvanhoef.com/ccs2017.pdf

如果点了上面的连接, 发现看不懂退回来的话, 可以看看下面用最 **俗** 的文字数数关于 wifi 安全.

## 保护无线安全的几种加密方式
### WEP
收集 5000 个数据包就可以将密码破解, 并且可以将原始数据从加密的数据包里分离出来, 例如网站登录的用户名, 密码之类. 目前这种加密方式已很少用.

### WPS
2011 年已被证明通过暴力破解大约几小时就可以将 PIN 码计算出来, 目前大多数的无线设备已默认不启用 WPS 功能.

### WPA/2
当 WEP 证明不安全的时候, WPA 被设计成为 WEP 的过度方案, 直至后来另外一个无线标准被定案时, 也就是 WPA2. 今天大多数的无线设备都可以同时支持这两种加密方式, 技术上有差异, 今天 WPA 有问题 WPA2 也同样有问题就知道他们加密的方法是一样的. 今天出现漏洞的也就是它了.

## 问题出在哪?
### 破解无线密码
有句话是这样说: **只要是密码, 就有被破解的一天.**

WPA/2 有两种模式, 一是企业使用有认证服务器的, 在家里应该不会有人无聊到自己架一台认证服务器, 所以一般使用都是个人模式, 设一个固定的密码完事. 基于"只要是密码, 就有被破解的一天"的理论, 所以之前报道被警察抓的三位黑(骇)客有两位家里都没有网络. 所以, 祈祷自己不是他们的邻居.

先说说破解无线密码, 使用 aircrack 的话主要是这三步:
1. 把自己的无线网卡设为黑洞模式, 把空气中的无线信号都记录下来;
2. 第一次连接到无线网络时, 会有完整的验证过程, 所以黑(骇)客会发一个数据包让某台手机踢下线, 当这台手机再次上线时, 完整的密钥就有了;
3. 破解;

据我自己试验的时候, 生成8位数字的密码字典大约是一部半高清的电影大小(1.3GB), 大约一个多小时就可以把密码破解出来. 最明显的效果就是免费用你家的网络, 对没有安全更新的电脑, "他"就在浏览自己的电脑一样随便逛.

### KRACK 漏洞
KRACK 漏洞是利用当手机掉线时, 为了快速连到网络, 手机放弃重新验证无线密码的过程(是的, 跟上面不同), 允许先前的的手机使用同样的值重连接到无线路由器, 上面[连接一](https://www.krackattacks.com/)就是安全研究人员演示实现方法中, 大致是这样:
1. 电脑的无线网卡设为黑洞模式, 找到你家的无线路由器;
2. 假装成你家的无线路由器, 发送一个切换无线频道的数据包, 利用漏洞和你的手机建立无线连接;
3. 收到手机的数据之后, 先分离例如银行网站的加密连接, 然后再转发给到银行的服务器(一点都没有觉得有哪不对);
4. 重组手机的流量, 找出例如用户名密码之类的信息.

像这样:
- 正常模式: 银行 -- 无线路由器 -- 你的手机
- 被黑之后: 银行 -- 无线路由器 -- "他" -- 你的手机

[演示视频](https://youtu.be/Oh4WURZoR98): https://youtu.be/Oh4WURZoR98 (如果你能看的话, 反正是英文我也翻译不好所以就不搬了)

## 防范措施
- 使用 WPA2/AES, 并配合
- 超过8位数字和字母大小写混合的密码, 并定期更换
- 输入密码的时候, 确认和网站是使用 https (新浪微博使用 https 和 http 都可以登录, 不小心就中招了)
- 不是普通人能做的其他措施: MAC 过滤, VLAN 隔理, 防火墙, HTTPS/SSL, VPN

## 把无线的 SSID 隐藏有用吗?
可能有用, 只要你的无线信号不在空气中传输.
